---
title: Reader Monad
description: Dependency injection and environment management
---

The `Reader` monad represents computations that depend on an environment/context. It's commonly used for dependency injection.

---

## Overview

```python
from better_py import Reader

# Create a Reader that needs a database connection
def get_user(user_id: int) -> Reader[Database, User]:
    return Reader.ask().map(lambda db: db.find(user_id))
```

<Callout type="success" title="When to Use Reader">

-  Dependency injection
-  Configuration access
-  Environment-dependent computations
-  Testing with mock dependencies

</Callout>

---

## Creating Reader Values

### Reader.ask()

Get the environment:

```python
from better_py import Reader

env = Reader.ask()
```

### Reader.from_fn()

Create from a function:

```python
def needs_config(config: Config) -> str:
    return config.get("api_key")

reader = Reader.from_fn(needs_config)
```

---

## Running Reader

### run()

Provide the environment:

```python
from better_py import Reader

def get_database_url(config: Config) -> Reader[Config, str]:
    return Reader.ask().map(lambda c: c.db_url)

reader = get_database_url(config)
url = reader.run(actual_config)
```

---

## Real-World Examples

### Example 1: Dependency Injection

```python
from better_py import Reader

class Database:
    def find(self, id: int): ...

class Logger:
    def log(self, message: str): ...

def fetch_user(user_id: int) -> Reader[tuple[Database, Logger], User]:
    return (
        Reader.ask()
        .map(lambda deps: deps[0].find(user_id))
        .tap(lambda user: 
            Reader.ask().map(lambda deps: deps[1].log(f"Found user {user_id}"))
        )
    )

# Run with dependencies
deps = (Database(), Logger())
user = fetch_user(1).run(deps)
```

### Example 2: Configuration

```python
from better_py import Reader

def get_api_key() -> Reader[Config, str]:
    return Reader.ask().map(lambda config: config.api_key)

def get_database_url() -> Reader[Config, str]:
    return Reader.ask().map(lambda config: config.db_url)

# Combine
def get_app_config() -> Reader[Config, dict]:
    return (
        get_api_key().ap(get_database_url())
        .map(lambda parts: {"api_key": parts[0], "db_url": parts[1]})
    )
```

---

## See Also

- [State Monad](/docs/monads/state) - For state management
- [Dependency Injection Guide](/docs/guides/state-management) - Patterns
